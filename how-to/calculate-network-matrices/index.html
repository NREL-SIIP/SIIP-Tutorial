<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <link rel="stylesheet" href="/SIIP-Tutorial/libs/highlight/github.min.css">
   
  <link rel="stylesheet" href="/SIIP-Tutorial/css/franklin.css">
  <link rel="stylesheet" href="/SIIP-Tutorial/css/basic.css">
  <link rel="icon" href="/SIIP-Tutorial/assets/favicon.png">
  <title>SIIP Tutorial</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/1.33.1/plotly.min.js" integrity="sha512-V0j9LhrK9IMNdFYZqh+IqU4cjo7wdxyHNyH+L0td4HryBuZ7Oq6QxP2/CWr6TituX31+gv5PnolvERuTbz8UNA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
      const PlotlyJS_json = async (div, url) => {
        response = await fetch(url)
        fig = await response.json()
        if (typeof fig.config === 'undefined') { fig["config"]={} }
          delete fig.layout.width
          delete fig.layout.height
          fig["layout"]["autosize"] = true
          fig["config"]["autosizable"] = true
          fig["config"]["responsive"] = true
          fig.config["scrollZoom"] = false
          delete fig.config.staticPlot
          delete fig.config.displayModeBar
          delete fig.config.doubleClick
          delete fig.config.showTips
          Plotly.newPlot(div, fig);
      }
  </script>
</head>
<body>
  <header>
  <div class="blog-name"><a href="/SIIP-Tutorial/">SIIP Tutorial</a></div>
  <nav>
    <ul>
      <li><a href="/SIIP-Tutorial/">Home</a></li>
    </ul>
    <img src="/SIIP-Tutorial/assets/hamburger.svg" id="menu-icon" />
  </nav>
</header>



<div class="franklin-content" >
  <h1 id="using_powersystems_to_calculate_network_matrices" ><a href="#using_powersystems_to_calculate_network_matrices"> Using PowerSystems to calculate network matrices</a></h1><p><strong>Originally Contributed by</strong>: Clayton Barrows</p>
<h2 id="introduction" ><a href="#introduction"> Introduction</a></h2><p>PowerSystems.jl supports the calculation of several different matrix representations of
power system networks. This example demonstrates how to use PowerSystems.jl to calculate:</p>
<ul>
<li>Y bus</li>
<li>Power transfer distribution factor (PTDF)</li>
<li>Line outage distribution  factor (LODF)</li>
</ul>
<h3 id="dependencies" ><a href="#dependencies"> Dependencies</a></h3><p>Let's use a dataset from the <a href="https://nbviewer.jupyter.org/github/NREL-SIIP/SIIPExamples.jl/blob/master/notebook/2_PowerSystems_examples/parse_matpower.ipynb">tabular data parsing example</a></p>
<pre><code class="julia">using PowerSystems
using TimeSeries
base_dir = PowerSystems.download(PowerSystems.TestData; branch = &quot;master&quot;);
sys = System(joinpath(base_dir, &quot;matpower&quot;, &quot;case5_re.m&quot;))
sys</code></pre>
<div class="code-output"><pre><code class="code-stdout language-plaintext">┌ Error: Generator voltage set-points for bus 3 are inconsistent. This can lead to unexpected results
└ @ PowerSystems ~/.julia/packages/PowerSystems/M5MJB/src/parsers/pm_io/matpower.jl:245
┌ Error: Generator voltage set-points for bus 10 are inconsistent. This can lead to unexpected results
└ @ PowerSystems ~/.julia/packages/PowerSystems/M5MJB/src/parsers/pm_io/matpower.jl:245
</code></pre><pre><code class="code-result language-plaintext">PowerSystems.System(Arc(Bus(2, bus2, PowerSystems.BusTypesModule.BusTypes.PQ = 2, -0.012822061349776342, 1.08407, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}()), Bus(3, bus3, PowerSystems.BusTypesModule.BusTypes.PV = 3, -0.00976895688926266, 1.1, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}()))
Arc(Bus(1, bus1, PowerSystems.BusTypesModule.BusTypes.PV = 3, 0.048935017968641414, 1.07762, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}()), Bus(10, bus5, PowerSystems.BusTypesModule.BusTypes.PV = 3, 0.06266307973312801, 1.06907, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}()))
Arc(Bus(1, bus1, PowerSystems.BusTypesModule.BusTypes.PV = 3, 0.048935017968641414, 1.07762, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}()), Bus(4, bus4, PowerSystems.BusTypesModule.BusTypes.REF = 4, 0.0, 1.06414, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}()))
Arc(Bus(1, bus1, PowerSystems.BusTypesModule.BusTypes.PV = 3, 0.048935017968641414, 1.07762, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}()), Bus(2, bus2, PowerSystems.BusTypesModule.BusTypes.PQ = 2, -0.012822061349776342, 1.08407, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}()))
Arc(Bus(3, bus3, PowerSystems.BusTypesModule.BusTypes.PV = 3, -0.00976895688926266, 1.1, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}()), Bus(4, bus4, PowerSystems.BusTypesModule.BusTypes.REF = 4, 0.0, 1.06414, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}()))
Arc(Bus(4, bus4, PowerSystems.BusTypesModule.BusTypes.REF = 4, 0.0, 1.06414, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}()), Bus(10, bus5, PowerSystems.BusTypesModule.BusTypes.PV = 3, 0.06266307973312801, 1.06907, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}()))
Bus(1, bus1, PowerSystems.BusTypesModule.BusTypes.PV = 3, 0.048935017968641414, 1.07762, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}())
Bus(4, bus4, PowerSystems.BusTypesModule.BusTypes.REF = 4, 0.0, 1.06414, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}())
Bus(10, bus5, PowerSystems.BusTypesModule.BusTypes.PV = 3, 0.06266307973312801, 1.06907, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}())
Bus(2, bus2, PowerSystems.BusTypesModule.BusTypes.PQ = 2, -0.012822061349776342, 1.08407, (min = 0.9, max = 1.1), 230.0, Area(1, 0.0, 0.0, 0.0), LoadZone(1, 10.0, 3.2869), Dict{String, Any}())

***Omitted 21 components***



InfrastructureSystems.TimeSeriesParameters(Dates.Minute(0), InfrastructureSystems.ForecastParameters(0, Dates.DateTime("0001-01-01T00:00:00"), Dates.Minute(0), 0)), 60.0, Set([4, 2, 10, 3, 1]), Base.RefValue{Bool}(true), InfrastructureSystems.SystemUnitsSettings(100.0, InfrastructureSystems.UnitSystemModule.UnitSystem.SYSTEM_BASE = 0), InfrastructureSystems.InfrastructureSystemsInternal(UUID("45c714d7-aa00-4450-b4fa-38d87ffff1e9"), nothing, Dict{String, Any}()))</code></pre></div><h3 id="ybus" ><a href="#ybus"> Ybus</a></h3><pre><code class="julia">ybus = Ybus(sys)</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">PowerNetworkMatrix
    Dimension 1, [1, 2, 3, 4, 10]
    Dimension 2, [1, 2, 3, 4, 10]
And data, a (5, 5):
  22.250685688535143 - 222.48437688535142im  -3.5234840209999647 + 35.234840209999646im                      ⋅                      -3.2569046378322044 + 32.56904637832204im   -15.470297029702971 + 154.7029702970297im
 -3.5234840209999647 + 35.234840209999646im    12.69106744600913 - 126.89785446009131im  -9.167583425009166 + 91.67583425009167im                        ⋅                                           ⋅     
                      ⋅                       -9.167583425009166 + 91.67583425009167im   15.524984093269492 - 155.2405809326949im    -7.457074339365532 + 63.377922205722975im                       ⋅     
 -3.2569046378322044 + 32.56904637832204im                        ⋅                      -5.240674104131404 + 63.599562229246395im   12.947972006095863 - 129.46663337161624im  -3.3336667000033335 + 33.33666700003334im
 -15.470297029702971 + 154.7029702970297im                        ⋅                                          ⋅                      -3.3336667000033335 + 33.33666700003334im    18.803963729706304 - 188.02063729706305im</code></pre></div><h3 id="ptdf" ><a href="#ptdf"> PTDF</a></h3><pre><code class="julia">ptdf = PTDF(sys)</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">PowerNetworkMatrix
    Dimension 1, ["bus1-bus2-i_1", "bus1-bus4-i_2", "bus1-bus5-i_3", "bus2-bus3-i_4", "bus3-bus4-i_6", "bus3-bus4-i_5", "bus4-bus5-i_7"]
    Dimension 2, [1, 2, 3, 4, 10]
And data, a (7, 5):
  0.23244980808604176  -0.3717496616981997   -0.2196270379853814   0.0   0.19123986981040003
  0.4166701041818629    0.20180695920759403   0.1192261063349213   0.0   0.3428006120277377
  0.35088008773209495   0.16994270249060545   0.10040093165046003  0.0  -0.534040481838138
  0.23244980808604185   0.6282503383018003   -0.21962703798538125  0.0   0.19123986981040006
  0.11622490404302094   0.3141251691509003    0.39018648100730935  0.0   0.09561993490520007
  0.11622490404302094   0.3141251691509003    0.39018648100730935  0.0   0.09561993490520007
 -0.35088008773209517  -0.16994270249060553  -0.10040093165046005  0.0  -0.46595951816186226</code></pre></div><h3 id="lodf" ><a href="#lodf"> LODF</a></h3><pre><code class="julia">lodf = LODF(sys)</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">PowerNetworkMatrix
    Dimension 1, ["bus1-bus2-i_1", "bus1-bus4-i_2", "bus1-bus5-i_3", "bus2-bus3-i_4", "bus3-bus4-i_6", "bus3-bus4-i_5", "bus4-bus5-i_7"]
    Dimension 2, ["bus1-bus2-i_1", "bus1-bus4-i_2", "bus1-bus5-i_3", "bus2-bus3-i_4", "bus3-bus4-i_6", "bus3-bus4-i_5", "bus4-bus5-i_7"]
And data, a (7, 7):
 -1.0                   0.39848773353202505   0.35809994993668426  -0.9999999999999992   -0.36015442614025406  -0.36015442614025406  -0.35809994993668465
  0.5428571428571427   -1.0                   0.6419000500633144    0.5428571428571423    0.19551240276185214   0.19551240276185214  -0.6419000500633155
  0.45714285714285685   0.6015122664679742   -1.0                   0.4571428571428563    0.16464202337840178   0.16464202337840178   1.0000000000000007
 -0.9999999999999998    0.3984877335320252    0.35809994993668476  -1.0                  -0.3601544261402538   -0.3601544261402538   -0.3580999499366847
 -0.5000000000000001    0.19924386676601263   0.17904997496834213  -0.4999999999999993   -1.0                   0.6398455738597462   -0.1790499749683424
 -0.5000000000000001    0.19924386676601263   0.17904997496834213  -0.4999999999999993    0.6398455738597462   -1.0                  -0.1790499749683424
 -0.4571428571428572   -0.6015122664679746    1.0                  -0.45714285714285674  -0.1646420233784018   -0.1646420233784018   -1.0</code></pre></div><h3 id="indexing" ><a href="#indexing"> Indexing</a></h3><p>Note that the axes of these matrices that correspond to buses are indexed by bus number
(<code>::Int64</code>) while the branch axes are indexed by branch name (<code>::String</code>). You can access
specific elements of the matrices as follows:</p>
<pre><code class="julia">ptdf[&quot;bus3-bus4-i_6&quot;, 3]</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">0.39018648100730935</code></pre></div><p>Additionally, PowerSystems provides accessors to the network matrices that take <code>Componets</code>
as arguments so that you can pass references to the components themselves rather than the
name or number. For example:</p>
<pre><code class="julia">buses = collect(get_components(Bus, sys))
ybus[buses[1], buses[2]]</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">-3.2569046378322044 + 32.56904637832204im</code></pre></div><p>If you would instead like to index by bus name, something like the following should work:</p>
<pre><code class="julia">busname2num = get_components(Bus, sys) |&gt; (c -&gt; Dict(zip(get_name.(c), get_number.(c))))
ptdf[&quot;bus3-bus4-i_6&quot;, busname2num[&quot;bus3&quot;]]</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">0.39018648100730935</code></pre></div>
  <div class="page-foot">
  <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>
  Dheepak Krishnamurthy.  Last modified: March 9, 2022. Website built with
  <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the
  <a href="https://julialang.org">Julia programming language</a>.
</div>

<script>
  var coll = document.getElementsByClassName('collapsible')
  var i

  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener('click', function () {
      this.classList.toggle('active')
      var content = this.nextElementSibling
      if (content.style.display === 'block') {
        content.style.display = 'none'
      } else {
        content.style.display = 'block'
      }
    })
  }
</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.4.0/clipboard.min.js"></script>

<script>
  ;(function () {
    // Get the elements.
    // - the 'pre' element.
    // - the 'div' with the 'paste-content' id.

    var pre = document.getElementsByTagName('pre')

    // Add a copy button in the 'pre' element.
    // which only has the className of 'language-'.

    for (var i = 0; i < pre.length; i++) {
      var isResult = pre[i].children[0].className.indexOf('code-result')
      var isStdout = pre[i].children[0].className.indexOf('code-stdout')

      if (isResult !== 0 && isStdout !== 0) {
        var button = document.createElement('button')
        button.className = 'copy-button'
        button.textContent = 'Copy'

        pre[i].prepend(button)
      }
    }

    // Run Clipboard

    var copyCode = new Clipboard('.copy-button', {
      target: function (trigger) {
        return trigger.nextElementSibling
      },
    })

    // On success:
    // - Change the "Copy" text to "Copied".
    // - Swap it to "Copy" in 2s.
    // - Lead user to the "contenteditable" area with Velocity scroll.

    copyCode.on('success', function (event) {
      event.clearSelection()
      event.trigger.textContent = 'Copied'
      window.setTimeout(function () {
        event.trigger.textContent = 'Copy'
      }, 2000)
    })

    // On error (Safari):
    // - Change the  "Press Ctrl+C to copy"
    // - Swap it to "Copy" in 2s.

    copyCode.on('error', function (event) {
      event.trigger.textContent = 'Press "Ctrl + C" to copy'
      window.setTimeout(function () {
        event.trigger.textContent = 'Copy'
      }, 5000)
    })
  })()
</script>

</div>

    
    
        <script src="/SIIP-Tutorial/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>

    
  </body>

</html>
